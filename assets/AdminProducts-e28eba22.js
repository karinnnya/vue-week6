import{_ as U,o as i,c as d,a as t,ap as P,F as g,f,t as _,i as m,bx as y,r as x,b as C,bt as c,bj as r,bf as V,d as k}from"./index-b569f52f.js";const M={props:["pages","getProducts"]},A={"aria-label":"Page navigation example"},B={class:"pagination"},T=t("a",{class:"page-link",href:"#","aria-label":"Previous"},[t("span",{"aria-hidden":"true"},"«")],-1),E=[T],D=["onClick"],L={class:"page-link",href:"#"},I=t("a",{class:"page-link",href:"#","aria-label":"Next"},[t("span",{"aria-hidden":"true"},"»")],-1),N=[I];function R(l,e,n,w,o,a){return i(),d("nav",A,[t("ul",B,[t("li",{class:P(["page-item",{disabled:!n.pages.has_pre}]),onClick:e[0]||(e[0]=u=>n.getProducts(n.pages.current_page-1))},E,2),(i(!0),d(g,null,f(n.pages.total_pages,u=>(i(),d("li",{key:u+"page",class:P([{active:u===n.pages.current_page},"page-item"]),onClick:s=>l.$emit("changePage",u)},[t("a",L,_(u),1)],10,D))),128)),t("li",{class:P(["page-item",{disabled:!n.pages.has_next}]),onClick:e[1]||(e[1]=u=>n.getProducts(n.pages.current_page+1))},N,2)])])}const F=U(M,[["render",R]]),{VITE_APP_URL:h,VITE_APP_PATH:b}={VITE_APP_URL:"https://vue3-course-api.hexschool.io/v2",VITE_APP_PATH:"rin",BASE_URL:"./",MODE:"production",DEV:!1,PROD:!0},z={data(){return{products:[],tempProduct:{imagesUrl:[]},newProd:!1,pages:{}}},components:{pagination:F},methods:{checkAdmin(){m.post(`${h}/api/user/check`).then(()=>{this.getProducts()}).catch(l=>{alert("驗證錯誤"),window.location="login.html"})},getProducts(l=1){m.get(`${h}/api/${b}/admin/products/?page=${l}`).then(e=>{this.pages=e.data.pagination,this.products=e.data.products,console.log(this.pages)}).catch(e=>{console.log(e)})},open(l,e){l==="del"?(this.delModal.show(),this.tempProduct=e,this.newProd=!1):l=="edit"?(this.myModal.show(),this.tempProduct={...e},this.newProd=!1):l=="new"&&(this.tempProduct={imagesUrl:[]},this.newProd=!0,console.log(this.newProd),this.myModal.show())},delProd(){m.delete(`${h}/api/${b}/admin/product/${this.tempProduct.id}`).then(l=>{this.delModal.hide(),this.getProducts()}).catch(l=>{console.log(l)})},imgBtn(l,e){l==="del"?this.tempProduct.imagesUrl.splice(e,1):(this.tempProduct.imagesUrl=[],this.tempProduct.imagesUrl.push(""))},upImgBtn(){const l=imgfile.files[0];if(!l)alert("請確認圖片路徑");else{const e=new FormData;e.append("file-to-upload",l),m.post(`${h}/api/${b}/admin/upload`,e).then(n=>{this.tempProduct.imagesUrl?this.tempProduct.imagesUrl.push(n.data.imageUrl):(this.tempProduct.imagesUrl=[],this.tempProduct.imagesUrl.push(n.data.imageUrl))}).catch(n=>{console.log(n),alert("上傳圖片失敗")})}},sendProd(){this.newProd?m.post(`${h}/api/${b}/admin/product`,{data:this.tempProduct}).then(l=>{this.myModal.hide(),this.getProducts()}).catch(l=>{console.log(l),alert("新增商品失敗，請確認是否有誤")}):m.put(`${h}/api/${b}/admin/product/${this.tempProduct.id}`,{data:this.tempProduct}).then(()=>{this.myModal.hide(),this.getProducts()}).catch(l=>{console.log(l)})}},mounted(){const l=document.cookie.replace(/(?:(?:^|.*;\s*)hexToken\s*\=\s*([^;]*).*$)|^.*$/,"$1");m.defaults.headers.common.Authorization=l,this.checkAdmin(),this.delModal=new y(this.$refs.delmodal),this.myModal=new y(this.$refs.modal)}},H=t("h2",null,"後臺產品列表",-1),O={class:"container"},S={class:"text-end mt-4"},j={class:"table mt-4"},q=t("thead",null,[t("tr",null,[t("th",{width:"120"}," 分類 "),t("th",null,"產品名稱"),t("th",{width:"120"}," 原價 "),t("th",{width:"120"}," 售價 "),t("th",{width:"100"}," 是否啟用 "),t("th",{width:"120"}," 編輯 ")])],-1),G={key:0,class:"text-success"},J={key:1},K={class:"btn-group"},Q=["onClick"],W=["onClick"],X={ref:"modal",class:"modal fade",tabindex:"-1","aria-labelledby":"productModalLabel","aria-hidden":"true"},Y={class:"modal-dialog modal-xl"},Z={class:"modal-content border-0"},$={class:"modal-header bg-dark text-white"},tt={class:"modal-title"},et={key:0},st={key:1},ot=t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),lt={class:"modal-body"},nt={class:"row"},it={class:"col-sm-4"},dt={class:"mb-2"},at={class:"mb-3"},ct=t("h3",null,"主要圖片",-1),rt=t("label",{for:"imageUrl",class:"form-label"},"輸入圖片網址",-1),ut=["src"],mt=t("h3",null,"內容圖片",-1),pt={key:0},ht=t("label",{for:"imageUrl",class:"form-label"},"輸入圖片網址",-1),_t=["onUpdate:modelValue"],bt=["src"],gt=["onClick"],Pt={key:1},ft=t("div",null,null,-1),vt={class:"col-sm-8"},yt={class:"mb-3"},kt=t("label",{for:"title",class:"form-label"},"標題",-1),Ut={class:"row"},wt={class:"mb-3 col-md-6"},xt=t("label",{for:"category",class:"form-label"},"分類",-1),Ct={class:"mb-3 col-md-6"},Vt=t("label",{for:"price",class:"form-label"},"單位",-1),Mt={class:"row"},At={class:"mb-3 col-md-6"},Bt=t("label",{for:"origin_price",class:"form-label"},"原價",-1),Tt={class:"mb-3 col-md-6"},Et=t("label",{for:"price",class:"form-label"},"售價",-1),Dt=t("hr",null,null,-1),Lt={class:"mb-3"},It=t("label",{for:"description",class:"form-label"},"產品描述",-1),Nt={class:"mb-3"},Rt=t("label",{for:"content",class:"form-label"},"說明內容",-1),Ft={class:"mb-3"},zt={class:"form-check"},Ht=t("label",{class:"form-check-label",for:"is_enabled"},"是否啟用",-1),Ot={class:"modal-footer"},St=t("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"}," 取消 ",-1),jt={id:"delProductModal",ref:"delmodal",class:"modal fade",tabindex:"-1","aria-labelledby":"delProductModalLabel","aria-hidden":"true"},qt={class:"modal-dialog"},Gt={class:"modal-content border-0"},Jt=t("div",{class:"modal-header bg-danger text-white"},[t("h5",{id:"delProductModalLabel",class:"modal-title"},[t("span",null,"刪除產品")]),t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),Kt={class:"modal-body"},Qt=t("strong",{class:"text-danger"},null,-1),Wt={class:"modal-footer"},Xt=t("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"}," 取消 ",-1);function Yt(l,e,n,w,o,a){const u=x("pagination");return i(),d(g,null,[H,t("div",O,[t("div",S,[t("button",{class:"btn btn-primary",onClick:e[0]||(e[0]=s=>a.open("new"))}," 建立新的產品 ")]),t("table",j,[q,t("tbody",null,[(i(!0),d(g,null,f(o.products,s=>(i(),d("tr",{key:s.id},[t("td",null,_(s.category),1),t("td",null,_(s.title),1),t("td",null,_(s.origin_price),1),t("td",null,_(s.price),1),t("td",null,[s.is_enabled===1?(i(),d("span",G,"啟用")):(i(),d("span",J,"未啟用"))]),t("td",null,[t("div",K,[t("button",{type:"button",class:"btn btn-outline-primary btn-sm",onClick:p=>a.open("edit",s)}," 編輯 ",8,Q),t("button",{type:"button",class:"btn btn-outline-danger btn-sm",onClick:p=>a.open("del",s)}," 刪除 ",8,W)])])]))),128))])]),C(u,{pages:o.pages,"get-products":a.getProducts,onChangePage:a.getProducts},null,8,["pages","get-products","onChangePage"])]),t("div",X,[t("div",Y,[t("div",Z,[t("div",$,[t("h5",tt,[o.newProd?(i(),d("span",et,"新增產品")):(i(),d("span",st,"編輯"))]),ot]),t("div",lt,[t("div",nt,[t("div",it,[t("div",dt,[t("div",at,[ct,rt,c(t("input",{type:"text",class:"form-control",placeholder:"請輸入圖片連結","onUpdate:modelValue":e[1]||(e[1]=s=>o.tempProduct.imageUrl=s)},null,512),[[r,o.tempProduct.imageUrl]])]),t("img",{class:"img-fluid",src:o.tempProduct.imageUrl,alt:""},null,8,ut),mt,Array.isArray(o.tempProduct.imagesUrl)?(i(),d("div",pt,[(i(!0),d(g,null,f(o.tempProduct.imagesUrl,(s,p)=>(i(),d("div",{class:"mb-3",key:p},[ht,c(t("input",{type:"text",class:"form-control",placeholder:"請輸入圖片連結","onUpdate:modelValue":v=>o.tempProduct.imagesUrl[p]=v},null,8,_t),[[r,o.tempProduct.imagesUrl[p]]]),t("img",{src:s,alt:"",class:"images m-2",style:{width:"100%"}},null,8,bt),t("button",{class:"btn btn-outline-danger btn-sm d-block w-100",onClick:v=>a.imgBtn("push",p)}," 刪除圖片 ",8,gt)]))),128)),t("div",null,[t("button",{class:"btn btn-outline-primary btn-sm d-block w-100",onClick:e[2]||(e[2]=s=>o.tempProduct.imagesUrl.push(""))}," 新增圖片 ")])])):(i(),d("div",Pt,[t("button",{class:"btn btn-outline-primary btn-sm d-block w-100",onClick:e[3]||(e[3]=(...s)=>a.imgBtn&&a.imgBtn(...s))}," 新增圖片 ")])),ft])]),t("div",vt,[t("div",yt,[kt,c(t("input",{id:"title",type:"text",class:"form-control","onUpdate:modelValue":e[4]||(e[4]=s=>o.tempProduct.title=s),placeholder:"請輸入標題"},null,512),[[r,o.tempProduct.title]])]),t("div",Ut,[t("div",wt,[xt,c(t("input",{id:"category",type:"text",class:"form-control",placeholder:"請輸入分類","onUpdate:modelValue":e[5]||(e[5]=s=>o.tempProduct.category=s)},null,512),[[r,o.tempProduct.category]])]),t("div",Ct,[Vt,c(t("input",{id:"unit",type:"text",class:"form-control",placeholder:"請輸入單位","onUpdate:modelValue":e[6]||(e[6]=s=>o.tempProduct.unit=s)},null,512),[[r,o.tempProduct.unit]])])]),t("div",Mt,[t("div",At,[Bt,c(t("input",{id:"origin_price",type:"number",min:"0",class:"form-control",placeholder:"請輸入原價","onUpdate:modelValue":e[7]||(e[7]=s=>o.tempProduct.origin_price=s)},null,512),[[r,o.tempProduct.origin_price,void 0,{number:!0}]])]),t("div",Tt,[Et,c(t("input",{id:"price",type:"number",min:"0",class:"form-control",placeholder:"請輸入售價","onUpdate:modelValue":e[8]||(e[8]=s=>o.tempProduct.price=s)},null,512),[[r,o.tempProduct.price,void 0,{number:!0}]])])]),Dt,t("div",Lt,[It,c(t("textarea",{id:"description",type:"text",class:"form-control",placeholder:"請輸入產品描述","onUpdate:modelValue":e[9]||(e[9]=s=>o.tempProduct.description=s)},`\r
                  `,512),[[r,o.tempProduct.description]])]),t("div",Nt,[Rt,c(t("textarea",{id:"description",type:"text",class:"form-control",placeholder:"請輸入說明內容","onUpdate:modelValue":e[10]||(e[10]=s=>o.tempProduct.content=s)},`\r
                  `,512),[[r,o.tempProduct.content]])]),t("div",Ft,[t("div",zt,[c(t("input",{id:"is_enabled","onUpdate:modelValue":e[11]||(e[11]=s=>o.tempProduct.is_enabled=s),class:"form-check-input",type:"checkbox","true-value":1,"false-value":0},null,512),[[V,o.tempProduct.is_enabled]]),Ht])])])])]),t("div",Ot,[St,t("button",{type:"button",class:"btn btn-primary",onClick:e[12]||(e[12]=s=>a.sendProd(o.newProd,o.tempProduct))}," 確認 ")])])])],512),t("div",jt,[t("div",qt,[t("div",Gt,[Jt,t("div",Kt,[k(" 是否刪除 "),Qt,k(" "+_(o.tempProduct.title)+"(刪除後將無法恢復)。 ",1)]),t("div",Wt,[Xt,t("button",{type:"button",class:"btn btn-danger",onClick:e[13]||(e[13]=s=>a.delProd(l.i))}," 確認刪除 ")])])])],512)],64)}const $t=U(z,[["render",Yt]]);export{$t as default};
